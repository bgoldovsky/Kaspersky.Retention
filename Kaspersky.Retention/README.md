# Kaspersky.Services.Retention

Тестовое задание для Kaspersky (11.08.2019).

Микросервис применяющий заданные политики к хранилищу резервных копий.

## Политики хранения

Резервные копии создаются по расписанию дважды в сутки.
(По умолчанию в 8:00 и 20:00)

Раз в сутки происходит проверка политик хранения с последующим удалением всех устаревших резервных копий.
Процедура проверки идемпотентна, при сбоях или повторном запуске не возникнет ошибок бизнес-логики или сайд-эффектов.

Обе операции имеют ретраинг.

| Поколение | Период хранения (дни)    | Максимальное количество копий |
|  :---:    | :---:                    |  :----:   |     
| 0         | 0-3                      | 4         | 
| 1         | 3-7                      | 4         |
| 2         | 7-14                     | 4         | 
| 3         | \>14                     | 1         | 

## Технологический стек

* C# 7.3
* .NET Core 2.2

## Слои сервиса

0. **Client.** Фейковый клиент микросервиса Kaspersky.Backup.
0. **Host.** Хост микросервиса, точка входа, подключение зависимостей.
0. **Services** Job выполняющий резервное копирование и hosted service для проверки соответствия резервных копий текущим политикам.
0. **Models.** Модели используемые несколькими слоями микросервиса, в т.ч. DTO для конфигурации и примитивы.

## Примитивы

#### BackupGeneration

Поколения резервных копий, определяются согласно указанным политикам хранения.
Определяют время жизни резервных копий.

- [ ] Zero = 0
- [ ] First = 1
- [ ] Second = 2
- [ ] Third = 3

## Конфигурация

Конфигурация создания резервных копий. Содержит строку в формате cron, конфигурирующую Hangfire scheduler.
По умолчанию создание резервных копий происходит дважды в день, в 8:00 и 20:00.

    "RetentionBackupJob" : {
        "Cron": "0 8,20 * * *"
    }
    
Конфигурация применения политик хранения. 
Содержит интервал между запусками проверки соответствия резервных копий заданным политикам.

    "PolicyService": {
        "Interval": "12:00:00"
    }

© Boris B Goldovsky, 2019